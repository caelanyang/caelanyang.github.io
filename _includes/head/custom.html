<!-- Theme Styles -->
<link rel="stylesheet" href="{{ '/assets/css/themes.css' | relative_url }}">

<script>
(function() {
  // Initialize theme on page load
  document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme') || 'default';
    applyTheme(savedTheme);
    initThemeSwitcher();
  });

  function applyTheme(themeName) {
    // Remove all theme classes
    document.body.className = document.body.className.replace(/theme-\w+/g, '');
    
    // Add new theme class (except for default)
    if (themeName !== 'default') {
      document.body.classList.add('theme-' + themeName);
    }

    // Save to localStorage
    localStorage.setItem('theme', themeName);
  }

  function initThemeSwitcher() {
    const toggleButton = document.getElementById('theme-toggle');
    const selector = document.getElementById('theme-selector');
    const options = selector.querySelectorAll('.theme-option');
    
    if (!toggleButton || !selector) return;

    // Toggle selector visibility
    toggleButton.addEventListener('click', function(e) {
      e.stopPropagation();
      selector.classList.toggle('active');
    });

    // Handle theme selection
    options.forEach(option => {
      option.addEventListener('click', function(e) {
        e.stopPropagation();
        const theme = this.getAttribute('data-theme');
        applyTheme(theme);
        selector.classList.remove('active');
        
        // Update active state
        options.forEach(opt => opt.classList.remove('active'));
        this.classList.add('active');
      });
    });

    // Close selector when clicking outside
    document.addEventListener('click', function(event) {
      if (!toggleButton.contains(event.target) && !selector.contains(event.target)) {
        selector.classList.remove('active');
      }
    });

    // Set initial active state
    const currentTheme = localStorage.getItem('theme') || 'default';
    const currentOption = selector.querySelector(`[data-theme="${currentTheme}"]`);
    if (currentOption) {
      currentOption.classList.add('active');
    }
  }

  // Make functions available globally if needed
  window.applyTheme = applyTheme;
})();
</script>